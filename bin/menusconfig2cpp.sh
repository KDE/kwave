#!/bin/sh
#
# menusconfig2cpp - stores entries menusconfig into a cpp file
# 
# 14.03.2000 by Thomas Eschenbacher <Thomas.Eschenbacher@gmx.de>
#
# This very kwave-specific script filters the entries of the menu
# configuration, creates a cpp file with a list of menu tokens
# and encapsulates each of them with the i18n() macro. The resulting
# file will not produce any executable code but all of the menu entries
# will get into the files for internationalization.
#
# parameters:
# $1 full path to the "menus.config" file
# $2 output file
#
# NOTE: this should be regarded to be a quick hack, only few error checking 
#       is performed !!!

# uncomment this for debugging
# set -x

(\
echo -e "\
/* \n\
 * this file was automatically generated by "`basename $0`" \n\
 * at "`(LANG=en;date)`" -> DO NOT EDIT ! \n\
 */\n\
\n\
#include <klocale.h> // (for i18n macro) \n\
\n\
static void dummy(const char *string_to_be_internationalized) { }\n\
\n\
static void internationalize_all()\n\
{\n\
"

cat $1 | awk ' \
    { split($0, a, ",") } \
    { pos=index(a[2], "#"); if (pos != 0) a[2]=substr(a[2],0,pos-1) } \
    { pos=index(a[2], ")"); if (pos != 0) a[2]=substr(a[2],0,pos-1) } \
    { ntokens=split(a[2], tokens, "/"); \
	for (i=1; i<=ntokens; i++) { \
	    { if (length(tokens[i]) != 0) print tokens[i] } \
	} 
    }' | \
    sort | \
    uniq |
    awk '{print("    dummy(i18n(\"" $0 "\"));") }'

echo -e "\
}\n\
\n\
/* end of file */\n"
) > $2
