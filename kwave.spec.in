#############################################################################
##    Kwave                - kwave.spec
##                           -------------------
##    begin                : Sun Feb 03 2008
##    copyright            : (C) 2008 by Thomas Eschenbacher
##    email                : Thomas.Eschenbacher@gmx.de
#############################################################################
#
#############################################################################
##                                                                          #
##    This program is free software; you can redistribute it and/or modify  #
##    it under the terms of the GNU General Public License as published by  #
##    the Free Software Foundation; either version 2 of the License, or     #
##    (at your option) any later version.                                   #
##                                                                          #
#############################################################################

# Please submit bugfixes or comments via http://bugs.opensuse.org/
#

# norootforbuild

%define ver @RPM_SHORT_VERSION@
%define release @RPM_RELEASE@

Summary:        @RPM_SUMMARY@
License:        GPL
Group:          Productivity/Multimedia/Sound/Editors and Convertors

Name:           @RPM_NAME@
Version:        @RPM_SHORT_VERSION@
Release:        @RPM_RELEASE@
Source0:        kwave-%{version}-1.tar.bz2
Url:            @RPM_URL@
BuildRoot:      %{_tmppath}/%{name}-%{version}-build
# hack for SLE
%ifarch i586
BuildArch:      i586
%endif
%ifarch x86_64
BuildArch:      x86_64
%endif

# common for all distributions
Requires:       %{name}-lang = %{version}
Requires:       audiofile >= 0.3.0
Requires:       flac
Requires:       libogg.so.0 >= 0.4.0
Requires:       libsamplerate >= 0.1.3
Requires:       libvorbis >= 1
Requires:       libvorbisenc.so.2 >= 2.0.0
BuildRequires:  ImageMagick
BuildRequires:  cmake >= 2.6.0
BuildRequires:  gettext-devel
BuildRequires:  sed

# SuSE specific:
%if %{defined suse_version}
Prefix:         /usr
Requires:       %kde4_runtime_requires
Requires:       alsa
Requires:       fftw3 >= 3.0
Requires:       libqt4 >= 4.7
Requires:       libopus
Requires:       pulseaudio >= 0.9.16
BuildRequires:  alsa-devel
BuildRequires:  audiofile-devel >= 0.3.0
BuildRequires:  awk
BuildRequires:  fdupes
BuildRequires:  fftw3-devel >= 3.0
BuildRequires:  flac-devel
BuildRequires:  kde4-l10n-devel
%if %{suse_version} >= 1301
BuildRequires:  kdemultimedia
%else
BuildRequires:  kdemultimedia4
%endif
BuildRequires:  libkde4-devel >= 4.0
BuildRequires:  libogg-devel >= 1
BuildRequires:  libopus-devel
BuildRequires:  libqt4-devel > 4.7
BuildRequires:  libsamplerate-devel
BuildRequires:  libvorbis-devel
BuildRequires:  pulseaudio-devel
BuildRequires:  rsvg-view
BuildRequires:  update-desktop-files
# BuildRequires:  librsvg
# BuildRequires:  python

%define EXTRA_OPTS ""
%define FDUPES %fdupes -s %{buildroot}
%endif

# CentOS specific:
%if %{defined centos_version}
Prefix:         /usr
Requires:       alsa-lib
Requires:       fftw3 >= 3.0
Requires:       kdelibs >= 4.0
Requires:       libopus
BuildRequires:  alsa-lib-devel
BuildRequires:  audiofile-devel >= 0.3.0
BuildRequires:  fftw3-devel >= 3.0
BuildRequires:  flac-devel
BuildRequires:  gawk
BuildRequires:  gcc-c++
BuildRequires:  kdemultimedia-devel >= 4.0
BuildRequires:  kdesdk >= 4.0
BuildRequires:  libogg-devel >= 1
BuildRequires:  libopus-devel
BuildRequires:  libsamplerate-devel
BuildRequires:  libvorbis-devel
BuildRequires:  pulseaudio-libs-devel
%define _kde4_applicationsdir /usr/share/applications/kde4/
%define _kde4_modulesdir %{_kde4_libdir}/kde4/plugins
%define _kde4_htmldir /usr/share/doc/HTML/
%endif

# Fedora specific:
%if %{defined fedora}
Prefix:         /usr
Requires:       alsa-lib
Requires:       fftw3 >= 3.0
Requires:       kdelibs >= 4.0
%if %{fedora_version} > 18
Requires:       opus
%else
Requires:       libopus
%endif
Requires:       pulseaudio >= 0.9.16
Requires:       qt4 >= 4.7
Requires:       qt4-x11 >= 4.7
BuildRequires:  alsa-lib-devel
BuildRequires:  audiofile-devel >= 0.3.0
BuildRequires:  fdupes
BuildRequires:  fftw3-devel >= 3.0
BuildRequires:  flac-devel
BuildRequires:  gawk
BuildRequires:  gcc-c++
BuildRequires:  kdelibs-devel >= 4.0
BuildRequires:  kdemultimedia-devel >= 4.0
%if %{fedora_version} > 19
BuildRequires:  poxml
%else
BuildRequires:  kdesdk-utils >= 4.0
%endif
BuildRequires:  libogg-devel >= 1
%if %{fedora_version} > 18
BuildRequires:  opus-devel
%else
BuildRequires:  libopus-devel
%endif
BuildRequires:  libsamplerate-devel
BuildRequires:  libvorbis-devel
BuildRequires:  pulseaudio-libs-devel >= 0.9.16
BuildRequires:  qt4-devel >= 4.7.0
%define EXTRA_OPTS ""
%define FDUPES fdupes -s %{buildroot}
%define _kde4_applicationsdir /usr/share/applications/kde4/
%define _kde4_modulesdir %{_kde4_libdir}/kde4/plugins
%define _kde4_htmldir /usr/share/doc/HTML/
%endif

# RedHat specific:
%if %{defined rhel_version}
Requires:       alsa-lib
Requires:       fftw3
Requires:       flac
Requires:       libogg
Requires:       libopus
Requires:       libsamplerate
Requires:       kdelibs >= 4.0
Requires:       pulseaudio >= 0.9.16
Requires:       pulseaudio-libs >= 0.9.16
Requires:       qt4 >= 4.7
Requires:       qt4-x11 >= 4.7
BuildRequires:  alsa-lib-devel
BuildRequires:  audiofile-devel >= 0.3.0
BuildRequires:  fftw3
BuildRequires:  fftw3-devel
BuildRequires:  flac
BuildRequires:  gcc-c++
BuildRequires:  kdelibs-devel >= 4.0
BuildRequires:  kdesdk-utils >= 4.0
BuildRequires:  libogg-devel >= 1
BuildRequires:  libopus-devel
BuildRequires:  libsamplerate-devel
BuildRequires:  libvorbis-devel
BuildRequires:  pulseaudio-libs-devel
BuildRequires:  qt-devel >= 4.7
%define _kde4_applicationsdir /usr/share/applications/kde4
%define _kde4_modulesdir %{_kde4_libdir}/kde4/plugins
%define _kde4_htmldir /usr/share/doc/HTML
%define EXTRA_OPTS -DWITH_FLAC=OFF
%endif

# Mandriva specific:
%if %{defined mandriva_version}
Prefix:         /usr
Requires:       alsa-lib
Requires:       fftw3 >= 3.0
Requires:       id3lib >= 3.8.1
Requires:       kdelibs4 >= 4.0
Requires:       kdemultimedia4 >= 4.0
Requires:       libopus
BuildRequires:  alsa-lib-devel
BuildRequires:  aspell-cs
BuildRequires:  aspell-de
BuildRequires:  aspell-es
BuildRequires:  aspell-fr
BuildRequires:  audiofile-devel >= 0.3.0
BuildRequires:  fftw3-devel >= 3.0
BuildRequires:  gawk
BuildRequires:  gcc-c++
BuildRequires:  id3lib-devel >= 3.8.1
BuildRequires:  kde-l10n-cs >= 4.0
BuildRequires:  kde-l10n-de >= 4.0
BuildRequires:  kde-l10n-es >= 4.0
BuildRequires:  kde-l10n-fr >= 4.0
BuildRequires:  kdelibs4-devel
BuildRequires:  kdemultimedia4-devel
BuildRequires:  kdesdk4-po2xml
BuildRequires:  libflac++-devel
BuildRequires:  libmad >= 0.14
BuildRequires:  libmad-devel >= 0.14
BuildRequires:  libogg-devel >= 1
BuildRequires:  libopus-devel
BuildRequires:  libsamplerate-devel
BuildRequires:  libvorbis-devel
BuildRequires:  pulseaudio-devel >= 0.9.16
%define _kde4_bindir /usr/bin
%define _kde4_libdir /usr/lib*
%define _kde4_appsdir /usr/share/apps
%define _kde4_iconsdir /usr/share/icons
%define _kde4_applicationsdir /usr/share/applications/kde4
%define _kde4_modulesdir %{_kde4_libdir}/kde4/plugins
%define _kde4_htmldir /usr/share/doc/HTML

# Mandriva has paid for using patented MP3 code and therefore are
# allowed to ship with MP3 support
%define MP3ENABLED "-DWITH_MP3=ON"
%define EXTRA_OPTS ""
%else
# all other distributions are not allowed to ship with MP3 support,
# at least not in the USA
%define MP3ENABLED "-DWITH_MP3=OFF"
%endif

%description
With Kwave you can record, play back, import and edit many
sorts of audio files including multi-channel files.<br>
Kwave includes some plugins to transform audio files in
several ways and presents a graphical view with a complete
zoom- and scroll capability.

%package doc
Summary:        HTML Documentation of Kwave
Group:          Documentation/HTML
BuildArch:      noarch

%description doc
This package contains the HTML documentation for Kwave

%package lang
Summary:        Languages for package Kwave
Group:          System/Localization
BuildArch:      noarch

%description lang
Provides translations to the package Kwave

%prep
%setup -q

%build
unset DESTDIR
mkdir build
cd build
CXXFLAGS="${CXXFLAGS} ${RPM_OPT_FLAGS}" CFLAGS="${CFLAGS} ${RPM_OPT_FLAGS}" \
    cmake ${CONFIGURE_OPTS} %{MP3ENABLED} %{EXTRA_OPTS} ..
cd -

make -C build %{?jobs:-j %jobs}

%install
make -C build DESTDIR="$RPM_BUILD_ROOT" SUID_ROOT="" install
%if %{defined FDUPES}
    %{FDUPES}
%endif
%find_lang kwave %{name}.lang

%files
%defattr(-,root,root)
%doc GNU-LICENSE AUTHORS LICENSES CHANGES README TODO kwave.lsm
%{_kde4_bindir}/%name
%{_kde4_applicationsdir}/%{name}.desktop
%{_kde4_libdir}/libkwave*
%{_kde4_appsdir}/%{name}
%{_kde4_modulesdir}/*
%{_kde4_iconsdir}/*
%exclude %{_kde4_htmldir}/*/%{name}

%files doc
%defattr(-,root,root,-)
%doc %{_kde4_htmldir}/*/%{name}

%files lang -f %{name}.lang
%defattr(-,root,root,-)
%exclude %{_kde4_htmldir}/*/%{name}

%clean
rm -Rf "$RPM_BUILD_ROOT"

%post
ldconfig

%postun
ldconfig

%changelog
