%define ver @RPM_SHORT_VERSION@
%define release @RPM_RELEASE@
%define filelist %{name}-@RPM_FULL_VERSION@/files.list.%{name}
%define rpm_opt_flags ${RPM_OPT_FLAGS}

Summary: @RPM_SUMMARY@
Name: @RPM_NAME@
Version: 	@RPM_SHORT_VERSION@
Release: 	@RPM_RELEASE@
Source0: 	kwave-@RPM_FULL_VERSION@.tar.gz
Group:  	@RPM_GROUP@
Copyright:	@RPM_COPYRIGHT@
URL:     @RPM_URL@
Vendor: 	@RPM_VENDOR@
BuildRoot: 	@RPM_BUILDROOT@
Prefix:   	@prefix@
Provides:@RPM_NAME@
Requires: 	libqt-mt.so >= 3.0.4
Requires: 	kdelibs >= 3.0.1
Requires:	id3lib >= 3.8.1
Requires:	libvorbis >= 0.2.0
Requires:	lobvorbisenc >= 2.0.0
Requires:	libogg >= 0.4.0

# libmad	(if not using builtin version)
# libaudiofile	(if not using builtin version)

Conflicts: 	libkwave
Obsoletes: 	libkwave

%description
@RPM_DESCRIPTION@

%prep

%setup -n kwave-@RPM_FULL_VERSION@
rm -rf "$RPM_BUILD_ROOT"
DESTDIR=""
unset DESTDIR
CONFIGURE_OPTS="--with-install-root=$RPM_BUILD_ROOT \
	--enable-static=no --enable-shared=yes ${CONFIGURE_OPTS}"
make -f Makefile.dist 

%build -n kwave-@RPM_FULL_VERSION@
DESTDIR=""
unset DESTDIR
make $MAKE_FLAGS

%install -n kwave-@RPM_FULL_VERSION@
rm -rf "$RPM_BUILD_ROOT"
make DESTDIR="$RPM_BUILD_ROOT" SUID_ROOT="" install

cd "$RPM_BUILD_ROOT"
find . -type d | sed '1,2d;s,^\.,\%attr(-\,root\,root) \%dir ,' > "$RPM_BUILD_DIR"/%{filelist}
find . -type f | sed 's,^\.,\%attr(-\,root\,root) \%dir ,' >> "$RPM_BUILD_DIR"/%{filelist}
find . -type l | sed 's,^\.,\%attr(-\,root\,root) \%dir ,' >> "$RPM_BUILD_DIR"/%{filelist}
# remove files/directories that should not get into the package
mv "$RPM_BUILD_DIR"/%{filelist} /tmp/files.lst.tmp
cat /tmp/files.lst.tmp | grep -v /default$ | \
	grep -v /de$ | grep -v /en$ > "$RPM_BUILD_DIR"/%{filelist}
rm -f /tmp/files.lst.tmp

%files -f files.list.%{name}

%doc GNU-LICENSE CHANGES README TODO kwave.lsm

%clean
rm -Rf "$RPM_BUILD_ROOT"

%post
ldconfig

%postun
ldconfig
